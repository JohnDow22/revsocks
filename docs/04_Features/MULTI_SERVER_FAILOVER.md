# Feature: Multi-Server Failover (Stealth Builder)

**–í–µ—Ä—Å–∏—è:** 2.3  
**–î–∞—Ç–∞:** 09.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

---

## üìå –ü—Ä–æ–±–ª–µ–º–∞

–û–¥–∏–Ω C2-—Å–µ—Ä–≤–µ—Ä ‚Äî –æ–¥–∏–Ω SPOF:
- –ø–∞–¥–µ–Ω–∏–µ –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ primary —Å–µ—Ä–≤–µ—Ä–∞ = –ø–æ—Ç–µ—Ä—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞–º–∏;
- —á–∞—Å—Ç—ã–µ retry —Å –æ–¥–Ω–æ–π —Ü–µ–ª—å—é —Å–æ–∑–¥–∞—é—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π ¬´—à—É–º¬ª –≤ –ª–æ–≥–∞—Ö –∏ —Å–µ—Ç–µ–≤—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∞—Ö;
- –ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö –≤—Ö–æ–¥–∞ (CDN, backup C2, —Ä–∞–∑–Ω—ã–µ –¥–æ–º–µ–Ω—ã) —Ç—Ä–µ–±–æ–≤–∞–ª–∞—Å—å —Ä—É—á–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω **Multi-Server Failover** –≤ stealth-–±–∏–Ω–∞—Ä–Ω–∏–∫–µ:
- —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ (`servers`) —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏;
- N –ø–æ–ø—ã—Ç–æ–∫ –∫ **–∫–∞–∂–¥–æ–º—É** —Å–µ—Ä–≤–µ—Ä—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º;
- –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–ª–Ω—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏ –ø–æ –≤—Å–µ–º —Å–µ—Ä–≤–µ—Ä–∞–º (`full_cycle_pause`);
- –∂—ë—Å—Ç–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω `main`).

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞: `retry_count` –ø–æ–ø—ã—Ç–æ–∫ —Å –ø–∞—É–∑–æ–π `retry_interval`;
2. –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–µ—Ä–≤–µ—Ä—É —Å –±–æ–ª—å—à–∏–º `priority`;
3. –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–¥–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ ‚Äî –ø–∞—É–∑–∞ `full_cycle_pause` –∏ –ø–æ–≤—Ç–æ—Ä;
4. –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è (observability).

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
cp config.yaml.example config.yaml
nano config.yaml  # –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–∞—à–∏ —Å–µ—Ä–≤–µ—Ä—ã
```

**–í–ê–ñ–ù–û:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä —Å `name: "main"`.

### –ü—Ä–∏–º–µ—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ main)

```yaml
stealth:
  servers:
    - address: "your-server:port"
      priority: 1
      name: "main"                    # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
  
  password: "your_password"
  
  failover:
    retry_count: 3                    # –ü–æ–ø—ã—Ç–æ–∫ –∫ –∫–∞–∂–¥–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
    retry_interval: 30                # –°–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
    full_cycle_pause: 7200            # –°–µ–∫—É–Ω–¥ (2 —á–∞—Å–∞) –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º —Ü–∏–∫–ª–∞
```

### –ü—Ä–∏–º–µ—Ä —Å backup —Å–µ—Ä–≤–µ—Ä–∞–º–∏

```yaml
stealth:
  servers:
    - address: "192.168.1.108:10443"
      priority: 1
      name: "main"                    # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –æ–¥–∏–Ω main
      
    - address: "backup1.domain.com:8443"
      priority: 2
      name: "backup1"
      
    - address: "backup2.domain.com:9443"
      priority: 3
      name: "backup2"
  
  password: "SFOpkm3rffAds90SF3ghSD"
  
  failover:
    retry_count: 3
    retry_interval: 30
    full_cycle_pause: 7200
```

### 2. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
make stealth
./sessions
```

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º Failover

```
1. –¶–∏–∫–ª –ø–æ–ø—ã—Ç–æ–∫ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ø–æ—Å–ª–µ full_cycle_pause):
   
   ‚îî‚îÄ> Main Server (priority: 1)
       ‚îú‚îÄ> –ü–æ–ø—ã—Ç–∫–∞ 1 (–∂–¥–µ–º retry_interval —Å–µ–∫ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ)
       ‚îú‚îÄ> –ü–æ–ø—ã—Ç–∫–∞ 2 (–∂–¥–µ–º retry_interval —Å–µ–∫ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ)
       ‚îú‚îÄ> –ü–æ–ø—ã—Ç–∫–∞ 3 (–∂–¥–µ–º retry_interval —Å–µ–∫ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ)
       ‚îî‚îÄ> –ï—Å–ª–∏ –≤—Å–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ Backup1
   
   ‚îî‚îÄ> Backup1 Server (priority: 2)
       ‚îú‚îÄ> –ü–æ–ø—ã—Ç–∫–∞ 1
       ‚îú‚îÄ> –ü–æ–ø—ã—Ç–∫–∞ 2
       ‚îú‚îÄ> –ü–æ–ø—ã—Ç–∫–∞ 3
       ‚îî‚îÄ> –ï—Å–ª–∏ –≤—Å–µ –Ω–µ—É–¥–∞—á–Ω—ã ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ Backup2
   
   ...
   
   ‚îî‚îÄ> –ü–æ—Å–ª–µ–¥–Ω–∏–π Backup Server
       ‚îî‚îÄ> –ï—Å–ª–∏ –≤—Å–µ –Ω–µ—É–¥–∞—á–Ω—ã ‚Üí –ü–ê–£–ó–ê full_cycle_pause (2 —á–∞—Å–∞)

2. –ü–æ—Å–ª–µ full_cycle_pause –Ω–∞—á–∏–Ω–∞–µ–º —Ü–∏–∫–ª –∑–∞–Ω–æ–≤–æ —Å Main Server
```

---

## üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Failover

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `retry_count` | 3 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ **–∫–∞–∂–¥–æ–º—É** —Å–µ—Ä–≤–µ—Ä—É |
| `retry_interval` | 30 | –°–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∫ **–æ–¥–Ω–æ–º—É** —Å–µ—Ä–≤–µ—Ä—É |
| `full_cycle_pause` | 7200 | –°–µ–∫—É–Ω–¥ (2 —á–∞—Å–∞) –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ |

### –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ failover

**–§–æ—Ä–º—É–ª–∞:**
```
–í—Ä–µ–º—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ = (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–µ—Ä–≤–µ—Ä–æ–≤ √ó retry_count √ó retry_interval) + full_cycle_pause
```

**–ü—Ä–∏–º–µ—Ä (4 —Å–µ—Ä–≤–µ—Ä–∞, 3 –ø–æ–ø—ã—Ç–∫–∏, 30 —Å–µ–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª):**
```
(4 √ó 3 √ó 30) + 7200 = 360 + 7200 = 7560 —Å–µ–∫—É–Ω–¥ = 2 —á–∞—Å–∞ 6 –º–∏–Ω—É—Ç
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ `main` ‚Üí —á–µ—Ä–µ–∑ `retry_count` –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ `backup1`;
- –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Å–µ—Ä–≤–µ—Ä–∞ ‚Üí –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —É—Ö–æ–¥–∏–º –Ω–∞ `full_cycle_pause` –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º;
- –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ ‚Äî –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è;
- –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ stdout (–ø—Ä–∏ `quiet_mode: false`).

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –°–±–æ—Ä–∫–∞ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π "–ù–µ –Ω–∞–π–¥–µ–Ω main —Å–µ—Ä–≤–µ—Ä"
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `config.yaml` –µ—Å—Ç—å —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä —Å `name: "main"`.

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–ª–∏–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä—ã
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞—Å—Å–∏–≤ `servers` –≤ `config.yaml`.
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∏–Ω–∞—Ä–Ω–∏–∫ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞.
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å–∞ –≤ –±–∏–Ω–∞—Ä–Ω–∏–∫–µ: `strings sessions | grep "backup_address"`.

---

## üìä –°—Ç–∞—Ç—É—Å

- **–í–µ—Ä—Å–∏—è:** 2.3  
- **–î–∞—Ç–∞:** 09.01.2026  
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
- **–¢–µ—Å—Ç—ã:** —Ä—É—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ + smoke —á–µ—Ä–µ–∑ stealth-—Å–±–æ—Ä–∫—É

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- Stealth Build: [STEALTH_BUILD.md](STEALTH_BUILD.md)
- –ë–∞–≥—Ñ–∏–∫—Å –ª–æ–≥–∏–∫–∏ failover: [2026_01_09_CRITICAL_BUGFIX_2_3.md](../05_Bugfixes/2026_01_09_CRITICAL_BUGFIX_2_3.md)

