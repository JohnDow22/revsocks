# Feature: Project Refactoring (Separation of Concerns)

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞:** 09.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

## üìå –ü—Ä–æ–±–ª–µ–º–∞
–†–∞–Ω–µ–µ RevSocks –±—ã–ª –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (–æ–¥–∏–Ω –±–∏–Ω–∞—Ä–Ω–∏–∫), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫:
- **Overhead:** –ê–≥–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∞–ª –≤ —Å–µ–±–µ –≤–µ—Å—å –∫–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞, DNS-—Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–∏—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
- **OPSEC:** –ù–∞–ª–∏—á–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–∏–≥–Ω–∞—Ç—É—Ä –≤ –∞–≥–µ–Ω—Ç–µ —É–ø—Ä–æ—â–∞–ª–æ –µ–≥–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **Complexity:** –§–ª–∞–≥–∏ –∑–∞–ø—É—Å–∫–∞ –±—ã–ª–∏ –æ–±—â–∏–º–∏, —á—Ç–æ –ø—É—Ç–∞–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`-listen` –≤ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Ç.–¥.).

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–ü—Ä–æ–µ–∫—Ç –±—ã–ª —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ `Standard Go Project Layout`, —Ä–∞–∑–¥–µ–ª–∏–≤ –ª–æ–≥–∏–∫—É –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **cmd/agent & cmd/server:** –°–æ–∑–¥–∞–Ω—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤.
2. **internal/ separation:** –õ–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –ø–∞–∫–µ—Ç—ã:
   - `internal/agent`: —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥.
   - `internal/server`: —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–¥ + `SessionManager`.
   - `internal/transport`: –æ–±—â–∏–π —Å–µ—Ç–µ–≤–æ–π —Å–ª–æ–π (TLS, Yamux).
   - `internal/common`: –æ–±—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã.
3. **Optimized Agent:** –†–∞–∑–º–µ—Ä –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ –∞–≥–µ–Ω—Ç–∞ —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ ~2MB –∑–∞ —Å—á–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–±–æ—Ä–∫–∞
```bash
make agent   # –°–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç–∞ (revsocks-agent)
make server  # –°–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–∞ (revsocks-server)
make default # –°–±–æ—Ä–∫–∞ –æ–±–æ–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
revsocks/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ agent/       # –ö–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ server/      # –°–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ common/      # –í–µ—Ä—Å–∏–∏, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ transport/   # TLS, Yamux
‚îÇ   ‚îú‚îÄ‚îÄ agent/       # –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ server/      # –°–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îî‚îÄ‚îÄ main.go          # Legacy wrapper
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∫—Ä—ã—Ç E2E —Ç–µ—Å—Ç–∞–º–∏ –≤ `tests/e2e/`, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

## üìä –°—Ç–∞—Ç—É—Å
- **–í–µ—Ä—Å–∏—è:** 2.0
- **–î–∞—Ç–∞:** 09.01.2026
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** -2MB —Ä–∞–∑–º–µ—Ä –∞–≥–µ–Ω—Ç–∞, —É–ª—É—á—à–µ–Ω–Ω—ã–π OPSEC.
