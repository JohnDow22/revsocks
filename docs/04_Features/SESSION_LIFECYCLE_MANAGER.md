# Feature: Session Lifecycle Manager

**–í–µ—Ä—Å–∏—è:** 2.2-stable  
**–î–∞—Ç–∞:** 09.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

## üìå –ü—Ä–æ–±–ª–µ–º–∞
–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Å—Å–∏–π –∞–≥–µ–Ω—Ç–æ–≤. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ ¬´—É—Ç–µ—á–∫–µ –ø–æ—Ä—Ç–æ–≤¬ª (–ø–æ—Ä—Ç—ã –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞) –∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Ç–æ—Ç –∂–µ –ø–æ—Ä—Ç (¬´Sticky Ports¬ª).

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–í–Ω–µ–¥—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏ `SessionManager`. –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- **Sticky Ports:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è `agentID -> port`. –ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∞–≥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ—Ç –∂–µ –ø–æ—Ä—Ç.
- **Deduplication:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ç–µ–º –∂–µ `agentID`.
- **Automatic Cleanup:** –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ yamux-—Å–µ—Å—Å–∏–∏ (–¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ keepalive) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ç–µ–≤–æ–π listener.
- **Generation Tokens:** –ó–∞—â–∏—Ç–∞ –æ—Ç –≥–æ–Ω–æ–∫ (race conditions) –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Å–µ—Å—Å–∏–π.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∞–∫—Ç–∏–≤–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è `agentID` (–∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ handshake –∏–ª–∏ IP).

## üîß API
- `RegisterSession(agentID, session, preferredPort, cancelFunc)` -> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `generation` –∏ `assignedPort`.
- `UnregisterSession(agentID, generation)` -> –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–∫–æ–ª–µ–Ω–∏—è.
- `SetListener(agentID, generation, listener)` -> –ø—Ä–∏–≤—è–∑–∫–∞ —Å–æ–∫–µ—Ç–∞ –∫ —Å–µ—Å—Å–∏–∏.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Smoke test: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ ‚Äî –ø–æ—Ä—Ç –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è.
- Reconnect test: –±—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞ ‚Äî –ø–æ—Ä—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, —Å—Ç–∞—Ä–∞—è —Å–µ—Å—Å–∏—è –≤—ã—Ç–µ—Å–Ω—è–µ—Ç—Å—è –Ω–æ–≤–æ–π.
- Race test: —Å–∏–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –æ—á–∏—Å—Ç–∫–∏ ‚Äî –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è ¬´–ø—Ä–∏–∑—Ä–∞–∫–æ–º¬ª —Å—Ç–∞—Ä–æ–π –±–ª–∞–≥–æ–¥–∞—Ä—è `generation`.

## üìä –°—Ç–∞—Ç—É—Å
- –í–µ—Ä—Å–∏—è: 2.2
- –î–∞—Ç–∞: 09.01.2026
- –¢–µ—Å—Ç—ã: 3/3 passed
