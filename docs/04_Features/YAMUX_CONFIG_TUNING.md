# Feature: Yamux Config Runtime Tuning

**–í–µ—Ä—Å–∏—è:** 2.6  
**–î–∞—Ç–∞:** 09.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

## üìå –ü—Ä–æ–±–ª–µ–º–∞

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã yamux (keepalive interval –∏ write timeout) –±—ã–ª–∏ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ:
- `KeepAliveInterval = 30 * time.Second` 
- `ConnectionWriteTimeout = 10 * time.Second`

–≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–µ—Ç–µ–π, –Ω–æ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏ –¥–ª—è:
- **–°–ø—É—Ç–Ω–∏–∫–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã:** –≤—ã—Å–æ–∫–∞—è latency (~500-2000ms), –Ω—É–∂–Ω—ã –±√≥–ª—å—à–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
- **–ú–æ–±–∏–ª—å–Ω—ã–µ —Å–µ—Ç–∏:** –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å, –≤—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
- **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ç–∏:** —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ —Å –±–æ–ª—å—à–∏–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥ —Å–≤–æ—é —Å–µ—Ç—å –±–µ–∑ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω—ã CLI —Ñ–ª–∞–≥–∏ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ yamux –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ runtime:
- `-yamux-keepalive` (—Å–µ–∫) - –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É keepalive –ø–∏–Ω–≥–∞–º–∏
- `-yamux-timeout` (—Å–µ–∫) - —Ç–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Å–∏ –≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

–ó–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–ª–∞–≥–æ–≤ —á–µ—Ä–µ–∑ `updateYamuxConfig()`.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û–±—ã—á–Ω—ã–µ —Å–µ—Ç–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

```bash
./revsocks -listen :8443 -socks 127.0.0.1:1080 -tls
# –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è: 30s keepalive, 10s timeout
```

### –°–ø—É—Ç–Ω–∏–∫–æ–≤—ã–µ / –º–æ–±–∏–ª—å–Ω—ã–µ —Å–µ—Ç–∏

```bash
./revsocks -listen :8443 -socks 127.0.0.1:1080 -tls \
  -yamux-keepalive 180 \
  -yamux-timeout 60
```

### –û—á–µ–Ω—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–µ—Ç—å

```bash
./revsocks -listen :8443 -socks 127.0.0.1:1080 -tls \
  -yamux-keepalive 300 \
  -yamux-timeout 120
```

## üîß API

### CLI –§–ª–∞–≥–∏

```
-yamux-keepalive int
    yamux keepalive interval in seconds (for satellite/mobile: 120-180)
    (default: 30)

-yamux-timeout int
    yamux write timeout in seconds (for satellite/mobile: 30-60)
    (default: 10)
```

### –§—É–Ω–∫—Ü–∏–∏ –≤ `yamux_config.go`

```go
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Ñ–ª–∞–≥–∞–º–∏)
var yamuxKeepAliveInterval = 30 * time.Second
var yamuxWriteTimeout = 10 * time.Second

// –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–ª–∞–≥–æ–≤
func updateYamuxConfig(keepaliveSeconds, timeoutSeconds int)
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `main.go`

```go
// –ü–æ—Å–ª–µ flag.Parse()
updateYamuxConfig(CurOptions.yamuxKeepalive, CurOptions.yamuxTimeout)
```

## üìä –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

| –°—Ü–µ–Ω–∞—Ä–∏–π | Keepalive | Timeout | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|-----------|---------|---------|
| –û–±—ã—á–Ω–∞—è —Å–µ—Ç—å | 30s | 10s | **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –±—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–æ–≤ |
| –°–ø—É—Ç–Ω–∏–∫ | 120-180s | 30-60s | –í—ã—Å–æ–∫–∞—è latency, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å |
| –ú–æ–±–∏–ª—å–Ω–∞—è (4G/5G) | 60-120s | 20-30s | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è—á–µ–µ–∫, –ø–µ—Ä–µ—Ä—ã–≤—ã |
| –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è (Proxy) | 60-120s | 30-60s | –ü—Ä–æ–∫—Å–∏ overhead |
| –û—á–µ–Ω—å –ø–ª–æ—Ö–∞—è —Å–≤—è–∑—å | 300s+ | 120s+ | –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è |

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –°–ø—É—Ç–Ω–∏–∫–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ –±–∞–∑–µ

```bash
# –ê–≥–µ–Ω—Ç –Ω–∞ —Å–ø—É—Ç–Ω–∏–∫–æ–≤–æ–º –∫–∞–Ω–∞–ª–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
./revsocks -connect example.com:8443 -pass mypass -tls \
  -yamux-keepalive 180 \
  -yamux-timeout 60

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
# (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –±—É–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
```

### –ü—Ä–∏–º–µ—Ä 2: –ú–æ–±–∏–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç

```bash
# –ö–ª–∏–µ–Ω—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ reverse proxy)
./revsocks -listen :8080 -socks 127.0.0.1:1080 \
  -yamux-keepalive 90 \
  -yamux-timeout 30
```

### –ü—Ä–∏–º–µ—Ä 3: Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```dockerfile
# Dockerfile
FROM golang:1.21
WORKDIR /app
COPY . .
RUN go build -o revsocks .

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ CMD
CMD ["./revsocks", "-listen", ":8443", \
     "-yamux-keepalive", "${YAMUX_KEEPALIVE:-30}", \
     "-yamux-timeout", "${YAMUX_TIMEOUT:-10}"]
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

```bash
$ go build -o revsocks .
$ ./revsocks -h | grep yamux
  -yamux-keepalive int
        yamux keepalive interval in seconds (for satellite/mobile: 120-180) (default 30)
  -yamux-timeout int
        yamux write timeout in seconds (for satellite/mobile: 30-60) (default 10)
```

## üìä –°—Ç–∞—Ç—É—Å

- –í–µ—Ä—Å–∏—è: 2.6
- –î–∞—Ç–∞: 09.01.2026
- –°—Ç–∞—Ç—É—Å: ‚úÖ Production Ready
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, CLI —Ñ–ª–∞–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ‚úÖ –ü–æ–ª–Ω–∞—è (–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30/10)

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –§–ª–∞–≥–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- Runtime –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: 1 —Å–µ–∫—É–Ω–¥–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –¥–æ 100+ —á–∞—Å–æ–≤)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Session Lifecycle Manager](SESSION_LIFECYCLE_MANAGER.md) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º yamux —Å–µ—Å—Å–∏–π
- [CHANGELOG.md](../../CHANGELOG.md#yamux-config---runtime-tuning)
