# Bugfix: Critical Bugfix Release 2.3 (9 –±–∞–≥–æ–≤)

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 09.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ (ISSUE)

–í –≤–µ—Ä—Å–∏–∏ –¥–æ 2.3 –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö, –Ω–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:
- –∫—Ä–∞—à–∏ –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö (`-proxyauth`, –¥–ª–∏–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å, –æ—à–∏–±–∫–∏ `net.Dial`);
- —É—Ç–µ—á–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ (HTTP Body, legacy `sessions[]` slice);
- –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ failover (round-robin –≤–º–µ—Å—Ç–æ N –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä);
- –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª—å/credentials –ø–æ–ø–∞–¥–∞—é—Ç –≤ stdout/stderr).

–í—Å–µ –≤–º–µ—Å—Ç–µ –æ–Ω–∏:
- –º–æ–≥–ª–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –ø–∞–¥–µ–Ω–∏—é –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–æ—á–Ω–æ–º –≤–≤–æ–¥–µ;
- –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞–∑–¥—É–≤–∞–ª–∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤;
- –ª–æ–º–∞–ª–∏ –æ–∂–∏–¥–∞–µ–º—É—é –ª–æ–≥–∏–∫—É failover;
- —Å–æ–∑–¥–∞–≤–∞–ª–∏ —Ä–∏—Å–∫–∏ —É—Ç–µ—á–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ –ª–æ–≥–∏.

---

## üîç Root Cause

- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ `-proxyauth` –∏ –ø–∞—Ä–æ–ª—è;
- –ù–µ–ø–æ–ª–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫ –∏ `nil`-–∑–Ω–∞—á–µ–Ω–∏–π –ø–æ—Å–ª–µ —Å–µ—Ç–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (`net.Dial`, `http.ReadResponse`);
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ `sessions[]` –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –Ω–æ–≤—ã–º `SessionManager` (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è);
- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è failover –±–µ–∑ —É—á—ë—Ç–∞ `retry_count` –Ω–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä;
- –ü—Ä—è–º–æ–π –≤—ã–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø—Ä–æ–∫—Å–∏ (`connectproxystring`) —Å –ø–æ–ª–Ω—ã–º–∏ `Proxy-Authorization` –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ (SOLUTION)

### 1. Crash Prevention

1. **–ü–∞—Ä—Å–∏–Ω–≥ `-proxyauth`:**
   - –≤—ã–Ω–µ—Å–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `parseProxyAuth()` —Å —á—ë—Ç–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ñ–æ—Ä–º–∞—Ç–∞;
   - –≤–º–µ—Å—Ç–æ `panic` ‚Äî –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∞—Ö `user`, `domain/user`, `user:`.
2. **`nil` –ø–æ—Å–ª–µ `net.Dial`:**
   - –¥–æ–±–∞–≤–ª–µ–Ω `return nil` –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø—Ä–æ–∫—Å–∏;
   - –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `resp` –≤ HTTP-–∫–æ–¥–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `resp != nil`.
3. **–î–ª–∏–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å:**
   - –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ø–∞—Ä–æ–ª—è;
   - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –±–µ–∑ –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Å—Å–∏–≤–∞.

### 2. Resource Leaks

4. **Legacy `sessions[]` slice:**
   - –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—ë–Ω –∏–∑ `agentHandler` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç;
   - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã –ø–æ —Å–µ—Å—Å–∏—è–º —Å—Ç–∞–ª `SessionManager`.
5. **HTTP Body leak:**
   - –≤ `WSconnectForSocks` –¥–æ–±–∞–≤–ª–µ–Ω `defer resp.Body.Close()` —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `httpClient.Do()`.

### 3. Logic Bugs

6. **Failover round-robin:**
   - –≤–≤–µ–¥–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `failoverAttempts`, —É—á–∏—Ç—ã–≤–∞—é—â–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ —Ç–µ–∫—É—â–µ–º —Å–µ—Ä–≤–µ—Ä–µ;
   - `getNextServer()` —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ—Ç N –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º;
   - –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–æ –≤—Å–µ–º —Å–µ—Ä–≤–µ—Ä–∞–º –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞—É–∑–∞ `full_cycle_pause`.
7. **`nil` –≤–º–µ—Å—Ç–æ `error` –ø—Ä–∏ —Å–±–æ–µ –ø—Ä–æ–∫—Å–∏:**
   - `connectviaproxy` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `errors.New("proxy connection failed")`;
   - retry-–ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–µ—É—Å–ø–µ—Ö.

### 4. Security

8. **–°–µ–∫—Ä–µ—Ç—ã –≤ –ª–æ–≥–∞—Ö:**
   - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `sanitizeProxyConnect()` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è `Proxy-Authorization` –∏–∑ –ª–æ–≥–∏—Ä—É–µ–º—ã—Ö —Å—Ç—Ä–æ–∫;
   - –≤—Å–µ –≤—ã–≤–æ–¥—ã `connectproxystring` –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç;
   - –ø–∞—Ä–æ–ª—å –±–æ–ª—å—à–µ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥–∏ (–æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ username).

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (TEST_RESULTS)

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ:
- ‚úÖ `go build` –±–µ–∑ –æ—à–∏–±–æ–∫;
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä: 0 –æ—à–∏–±–æ–∫;
- ‚úÖ –ë–∏–Ω–∞—Ä–Ω–∏–∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (~13 MB –¥–ª—è Go).

–†—É—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ):

1. **Panic tests:**
   ```bash
   ./revsocks -connect 127.0.0.1:9999 -proxyauth "useronly" -pass test
   ./revsocks -connect 127.0.0.1:9999 -proxy 127.0.0.1:12345 -pass test
   # –û–∂–∏–¥–∞–Ω–∏–µ: –ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞, –ë–ï–ó panic/crash
   ```

2. **Failover test:**
   ```bash
   # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –ø–µ—Ä–≤—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º
   # –û–∂–∏–¥–∞–Ω–∏–µ: 3 –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ –ø–µ—Ä–≤—ã–π —Å–µ—Ä–≤–µ—Ä ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—Ç–æ—Ä–æ–π
   ```

3. **Security test:**
   ```bash
   ./revsocks -connect test:8080 -proxyauth "DOMAIN/admin:Secret123" -pass test 2>&1 | grep "Secret123"
   # –û–∂–∏–¥–∞–Ω–∏–µ: –ø—É—Å—Ç–æ–π –≤—ã–≤–æ–¥ (–ø–∞—Ä–æ–ª—å –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥)
   ```

---

## üìä –°—Ç–∞—Ç—É—Å

- **Affected version:** < 2.3  
- **Fixed in:** 2.3-bugfix  
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL  
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ 9 –±–∞–≥–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ smoke-—Ç–µ—Å—Ç–∞ –Ω–∞ staging

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: `plans/2026-01-09_RevSocks_Bugfix/00_PLAN_INDEX.md`;
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã –ø–æ —ç—Ç–∞–ø–∞–º:
  - `01_Fix_Panics.md` ‚Äî Crash Prevention;
  - `02_Fix_Leaks.md` ‚Äî Resource Leaks;
  - `03_Fix_Logic.md` ‚Äî Logic Bugs;
  - `04_Fix_Security.md` ‚Äî Security.
- –û–±—â–∏–π –∏–Ω–¥–µ–∫—Å –±–∞–≥—Ñ–∏–∫—Å–æ–≤: [BUGFIXES_INDEX.md](BUGFIXES_INDEX.md)

